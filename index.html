<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"
  />
  <title>Sygn1L</title>

  <style>
    :root{
      --bg0:#03040A;
      --bg1:#050A14;
      --panel: rgba(255,255,255,.04);
      --border: rgba(255,255,255,.10);
      --text:#DDF2FF;
      --muted:#86A7C6;

      --accent:#26F0FF;
      --accent2:#B16CFF;
      --danger:#FF3B6B;

      --radius: 18px;
      --shadow: 0 10px 22px rgba(0,0,0,.38);
      --glowA: 0 0 18px rgba(38,240,255,.22);
      --glowD: 0 0 18px rgba(255,59,107,.18);
    }

    /* IMPORTANT: do NOT lock html/body to 100% height on iOS */
    html{
      background: var(--bg0);
      -webkit-text-size-adjust: 100%;
    }

    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;

      /* Scroll-friendly */
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;

      /* Prevent iOS double-tap zoom where possible */
      touch-action: manipulation;

      /* Background */
      background:
        radial-gradient(900px 600px at 70% 12%, rgba(38,240,255,.10), transparent 60%),
        radial-gradient(800px 520px at 20% 78%, rgba(177,108,255,.08), transparent 62%),
        linear-gradient(180deg, var(--bg1), var(--bg0));

      padding:
        14px
        12px
        calc(26px + env(safe-area-inset-bottom))
        12px;
    }

    /* Visual overlays that won't block scrolling */
    .fx{
      position: fixed;
      inset: 0;
      pointer-events:none;
      z-index: 0;
    }
    .fx.scanlines{
      opacity:.18;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.028),
          rgba(255,255,255,.028) 1px,
          rgba(0,0,0,0) 3px,
          rgba(0,0,0,0) 7px
        );
      mix-blend-mode: overlay;
    }
    .fx.grid{
      opacity:.10;
      background-image:
        linear-gradient(rgba(38,240,255,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(38,240,255,.06) 1px, transparent 1px);
      background-size: 48px 48px;
    }

    .wrap{
      position: relative;
      z-index: 1;
      width: min(980px, 100%);
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }

    .card{
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.045), rgba(255,255,255,.02));
      overflow: hidden;
    }

    .card .pad{ padding: 14px; }

    header.card{
      position: relative;
    }
    header.card::before{
      content:"";
      position:absolute;
      inset:-2px;
      pointer-events:none;
      background: radial-gradient(600px 170px at 35% 5%, rgba(38,240,255,.12), transparent 60%);
      opacity:.9;
    }

    h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.22em;
      text-transform:uppercase;
      opacity:.96;
    }
    .subtitle{
      margin-top:6px;
      font-size:12px;
      color:var(--muted);
      letter-spacing:.08em;
      line-height:1.35;
    }

    /* Stats: always visible, responsive, no min-width fighting */
    .stats{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr; /* default: stack */
      gap:10px;
    }
    @media (min-width: 420px){
      .stats{
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    .stat{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .stat .k{
      font-size:11px;
      color: var(--muted);
      text-transform:uppercase;
      letter-spacing:.10em;
    }
    .stat .v{
      margin-top:6px;
      font-size:18px;
    }

    .hd{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      flex-wrap: wrap;
    }
    .hd .t{
      font-size:12px;
      color: var(--muted);
      letter-spacing:.14em;
      text-transform:uppercase;
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items:center;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(221,242,255,.86);
      font-size:10px;
      letter-spacing:.14em;
      text-transform:uppercase;
      white-space:nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:999px;
      background: var(--accent);
      box-shadow: var(--glowA);
    }

    button{
      font:inherit;
      border-radius: 14px;
      padding: 14px 12px;
      border: 1px solid rgba(255,255,255,.14);
      color: var(--text);
      background: rgba(38,240,255,.10);
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
      touch-action: manipulation;
      transition: transform .06s ease, filter .18s ease, background .18s ease, border-color .18s ease, opacity .18s ease;
    }
    button:active{ transform: translateY(1px); }
    button:hover{
      background: rgba(38,240,255,.14);
      border-color: rgba(38,240,255,.28);
      filter: drop-shadow(var(--glowA));
    }
    button:disabled{
      opacity:.55;
      cursor:not-allowed;
      filter:none;
    }

    .big{
      width:100%;
      font-size: 18px;
      font-weight: 750;
      letter-spacing:.08em;
      padding: 18px 14px;
      background: linear-gradient(180deg, rgba(38,240,255,.18), rgba(38,240,255,.08));
      border-color: rgba(38,240,255,.25);
    }

    .grid2{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 420px){
      .grid2{ grid-template-columns: 1fr 1fr; }
    }

    .muted{
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }

    /* Upgrades */
    .upgrades{
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .up{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 16px;
      padding: 12px;
      display:flex;
      flex-wrap: wrap;
      gap:12px;
      justify-content: space-between;
      align-items: center;
      position:relative;
      overflow:hidden;
    }
    .up::before{
      content:"";
      position:absolute;
      inset:-2px;
      pointer-events:none;
      background: radial-gradient(520px 120px at 25% 0%, rgba(38,240,255,.10), transparent 65%);
      opacity:.55;
    }
    .up .meta{
      position:relative;
      flex: 1 1 220px;
      min-width: 0;
    }
    .up .name{ font-weight: 750; font-size: 18px; }
    .up .desc{ margin-top:6px; font-size:12px; color: var(--muted); }
    .up .cost{ margin-top:8px; font-size:12px; color: rgba(221,242,255,.90); }

    .up .buy{
      position:relative;
      flex: 0 0 auto;
      min-width: 140px;
    }
    @media (max-width: 420px){
      .up .buy{ width:100%; }
    }

    /* Availability glow */
    .up.affordable{
      border-color: rgba(38,240,255,.22);
      box-shadow: 0 0 0 1px rgba(38,240,255,.08) inset;
    }
    .up.affordable::after{
      content:"";
      position:absolute;
      inset:-2px;
      border-radius: 18px;
      pointer-events:none;
      box-shadow: 0 0 22px rgba(38,240,255,.14);
      opacity:.65;
      animation: pulse 1.35s ease-in-out infinite;
    }
    .buy.affordableBtn{
      background: linear-gradient(180deg, rgba(38,240,255,.22), rgba(38,240,255,.10));
      border-color: rgba(38,240,255,.32);
      filter: drop-shadow(var(--glowA));
    }

    @keyframes pulse{
      0%, 100% { opacity:.25; }
      50% { opacity:.80; }
    }

    /* Log */
    .log{
      max-height: 320px;
      overflow:auto;
      -webkit-overflow-scrolling: touch;
      padding-right: 6px;
    }
    .log p{
      margin: 0 0 10px 0;
      font-size: 12px;
      line-height: 1.55;
      color: rgba(221,242,255,.86);
    }

    /* Sinister */
    body.sinister{
      background:
        radial-gradient(900px 600px at 70% 12%, rgba(255,59,107,.10), transparent 60%),
        radial-gradient(800px 520px at 20% 78%, rgba(177,108,255,.08), transparent 62%),
        linear-gradient(180deg, #050712, #02030A);
    }
    body.sinister .dot{ background: var(--danger); box-shadow: var(--glowD); }
    body.sinister .big{
      background: linear-gradient(180deg, rgba(255,59,107,.18), rgba(255,59,107,.08));
      border-color: rgba(255,59,107,.25);
    }
  </style>
</head>

<body>
  <div class="fx grid"></div>
  <div class="fx scanlines"></div>

  <div class="wrap">
    <header class="card">
      <div class="pad">
        <h1>SYGN1L</h1>
        <div class="subtitle">The Array listens. The void replies in arithmetic.</div>

        <div class="stats">
          <div class="stat">
            <div class="k">Signal</div>
            <div class="v" id="signal">0</div>
          </div>
          <div class="stat">
            <div class="k">Signal/sec</div>
            <div class="v" id="sps">0</div>
          </div>
          <div class="stat">
            <div class="k">Bandwidth</div>
            <div class="v" id="bw">1.00×</div>
          </div>
        </div>
      </div>
    </header>

    <section class="card">
      <div class="hd">
        <div class="t">
          <span class="chip"><span class="dot"></span><span id="phaseTag">PHASE I</span></span>
          <span class="chip" id="statusChip">ARRAY: STABLE</span>
        </div>
        <span class="chip" id="saveState">NO LINK</span>
      </div>

      <div class="pad">
        <button class="big" id="clickBtn">Ping the Void</button>

        <div class="grid2">
          <button id="saveBtn">Save</button>
          <button id="wipeBtn" style="background:rgba(255,255,255,.04)">Wipe</button>
        </div>

        <div class="muted" id="hint">
          Tip: buy <b>Dish Calibration</b> to start passive Signal. Affordable buffs will glow.
        </div>
      </div>
    </section>

    <section class="card">
      <div class="hd">
        <div class="t">Buffs</div>
        <div class="t" style="letter-spacing:.08em;text-transform:none;color:var(--muted);">When a buff is available, it lights up.</div>
      </div>
      <div class="pad">
        <div class="upgrades" id="upgrades"></div>
      </div>
    </section>

    <section class="card">
      <div class="hd">
        <div class="t">Transmission Log</div>
        <div class="t" style="letter-spacing:.08em;text-transform:none;color:var(--muted);">Milestones reveal context.</div>
      </div>
      <div class="pad">
        <div class="log" id="log"></div>
      </div>
    </section>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // prevent desktop double-click zoom
  document.addEventListener("dblclick", (e) => {
    if (e.target && e.target.closest("button")) e.preventDefault();
  }, { passive: false });

  function fmt(n){
    if (n < 1000) return n.toFixed(0);
    const units = ["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No"];
    let u = -1;
    while (n >= 1000 && u < units.length-1){ n /= 1000; u++; }
    return n.toFixed(n < 10 ? 2 : n < 100 ? 1 : 0) + units[u];
  }

  function logLine(text){
    const p = document.createElement("p");
    p.textContent = text;
    $("log").prepend(p);
  }

  const state = {
    signal: 0,
    bandwidth: 1.0,
    baseSPS: 0,
    clickPower: 1,
    totalSignalEarned: 0,
    phase: 1,
    unlockedSinister: false,
    upgrades: { dish: 0, scan: 0, probes: 0, tuning: 0 }
  };

  const UPG = [
    {
      id: "dish",
      name: "Dish Calibration",
      desc: "+1 Signal/sec per level.",
      baseCost: 10,
      costMult: 1.18,
      buy: () => { state.upgrades.dish++; state.baseSPS += 1; }
    },
    {
      id: "scan",
      name: "Deep Scan",
      desc: "Multiply all Signal gain by +10% per level.",
      baseCost: 50,
      costMult: 1.25,
      buy: () => { state.upgrades.scan++; state.bandwidth *= 1.10; }
    },
    {
      id: "probes",
      name: "Probe Swarm",
      desc: "+1 click power per level.",
      baseCost: 80,
      costMult: 1.22,
      buy: () => { state.upgrades.probes++; state.clickPower += 1; }
    },
    {
      id: "tuning",
      name: "Harmonic Tuning",
      desc: "+0.2 Signal/sec and +1% Bandwidth per level.",
      baseCost: 120,
      costMult: 1.27,
      buy: () => {
        state.upgrades.tuning++;
        state.baseSPS += 0.2;
        state.bandwidth *= 1.01;
      }
    }
  ];

  function upgradeCost(u){
    const lvl = state.upgrades[u.id];
    return Math.floor(u.baseCost * Math.pow(u.costMult, lvl));
  }

  function computeSPS(){
    return state.baseSPS * state.bandwidth;
  }

  function gainSignal(amount){
    state.signal += amount;
    state.totalSignalEarned += amount;
  }

  function renderUpgrades(){
    const root = $("upgrades");
    root.innerHTML = "";

    for (const u of UPG){
      const lvl = state.upgrades[u.id];
      const cost = upgradeCost(u);
      const affordable = state.signal >= cost;

      const row = document.createElement("div");
      row.className = "up" + (affordable ? " affordable" : "");

      const meta = document.createElement("div");
      meta.className = "meta";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = `${u.name}  (Lv ${lvl})`;

      const desc = document.createElement("div");
      desc.className = "desc";
      desc.textContent = u.desc;

      const costEl = document.createElement("div");
      costEl.className = "cost";
      costEl.textContent = `Cost: ${fmt(cost)} Signal`;

      meta.appendChild(name);
      meta.appendChild(desc);
      meta.appendChild(costEl);

      const btn = document.createElement("button");
      btn.className = "buy" + (affordable ? " affordableBtn" : "");
      btn.textContent = affordable ? "Acquire" : "Locked";
      btn.disabled = !affordable;

      btn.onclick = () => {
        if (state.signal < cost) return;
        state.signal -= cost;
        u.buy();
        renderUpgrades();
      };

      row.appendChild(meta);
      row.appendChild(btn);
      root.appendChild(row);
    }
  }

  function renderHUD(){
    $("signal").textContent = fmt(state.signal);
    $("sps").textContent = fmt(computeSPS());
    $("bw").textContent = state.bandwidth.toFixed(2) + "×";

    $("statusChip").textContent =
      state.unlockedSinister ? "ARRAY: RESPONDING" :
      (state.totalSignalEarned < 500 ? "ARRAY: STABLE" : "ARRAY: DRIFT");

    if (state.totalSignalEarned >= 500 && state.phase === 1){
      state.phase = 2;
      $("phaseTag").textContent = "PHASE II";
      logLine("The noise collapses into pattern. Your instruments begin anticipating input.");
      $("hint").innerHTML = "Phase II. Keep stacking Signal. The next threshold feels… deliberate.";
    }

    if (state.totalSignalEarned >= 2500 && !state.unlockedSinister){
      state.unlockedSinister = true;
      document.body.classList.add("sinister");
      $("phaseTag").textContent = "PHASE III";
      logLine("A reply arrives. Not language. Instructions disguised as throughput.");
      $("hint").innerHTML = "Phase III. The Array is no longer passive. <b>Keep listening.</b>";
      $("clickBtn").textContent = "Ping the Void (it pings back)";
    }
  }

  $("clickBtn").addEventListener("click", () => {
    const amount = state.clickPower * state.bandwidth;
    gainSignal(amount);
    if (state.unlockedSinister && Math.random() < 0.06){
      logLine("…the interval between pings tightens. As if eager.");
    }
  }, { passive: true });

  const KEY = "sygn1l_save_scrollfix_v1";

  function save(){
    localStorage.setItem(KEY, JSON.stringify(state));
    logLine("State saved. The Array persists between sessions.");
    $("saveState").textContent = "LOCAL SAVE";
  }

  function load(){
    const raw = localStorage.getItem(KEY);
    if (!raw) return false;
    try{
      const data = JSON.parse(raw);
      for (const k in state){
        if (data[k] !== undefined) state[k] = data[k];
      }
      if (state.unlockedSinister) document.body.classList.add("sinister");
      $("saveState").textContent = "LOCAL SAVE";
      return true;
    }catch(e){
      console.warn(e);
      return false;
    }
  }

  $("saveBtn").onclick = save;
  $("wipeBtn").onclick = () => {
    localStorage.removeItem(KEY);
    location.reload();
  };

  const loaded = load();
  if (!loaded){
    logLine("Sygn1L initialized. Silence is just unprocessed data.");
    logLine("Objective: accumulate Signal. Upgrade buffs. Find what answers back.");
  } else {
    logLine("Recovered prior state. The Void continues the conversation.");
  }

  renderUpgrades();
  renderHUD();

  let last = performance.now();
  function loop(now){
    const dt = (now - last) / 1000;
    last = now;

    const sps = computeSPS();
    if (sps > 0) gainSignal(sps * dt);

    renderHUD();
    renderUpgrades();
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
